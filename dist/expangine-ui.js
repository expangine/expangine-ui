!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("expangine-runtime"),require("expangine-runtime-live")):"function"==typeof define&&define.amd?define(["expangine-runtime","expangine-runtime-live"],t):"object"==typeof exports?exports["expangine-ui"]=t(require("expangine-runtime"),require("expangine-runtime-live")):e["expangine-ui"]=t(e["expangine-runtime"],e["expangine-runtime-live"])}(window,(function(e,t){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)n.d(i,r,function(t){return e[t]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";n.r(t);function i(e){return o(new function(){},e)}function r(e,t){function n(){}return n.prototype=e,o(new n,t)}function o(e,t){for(const n in t)e[n]=t[n];return e}var s=n(0);const c=Object.create(null);var u=n(1),a={pop:1,push:1,shift:1,unshift:1,reverse:1,splice:1,sort:1},l={concat:1,every:1,fill:1,filter:1,find:1,findIndex:1,forEach:1,includes:1,indexOf:1,join:1,lastIndexOf:1,map:1,reduce:1,reduceRight:1,slice:1,some:1},f=function(){function e(e){this.value=e,this.next=this.prev=this}return e.prototype.forEach=function(e){for(var t=this.next,n=0;t!==this;){var i=t.next;e(t.value,t,n),t=i,n++}return n},e.prototype.toArray=function(){var e=[];return this.forEach((function(t){return e.push(t)})),e},e.prototype.insertAfter=function(e){this.next=e.next,this.prev=e,this.prev.next=this.next.prev=this},e.prototype.push=function(e){e.insertAfter(this.prev)},e.prototype.remove=function(){this.isEmpty()||(this.next.prev=this.prev,this.prev.next=this.next,this.prev=this.next=this)},e.prototype.isEmpty=function(){return this.next===this},e.head=function(){return new e(null)},e}(),d=function(){function e(e){this.observer=e,this.links=f.head()}return e.prototype.notify=function(e){void 0===e&&(e=!1);var t=!1;return this.links.toArray().forEach((function(e){e.watcher.notify(),t=t||e.watcher.deep})),e&&t&&this.observer.parent&&this.observer.parent.notify(e),t},e.prototype.destroy=function(){this.links.forEach((function(e){return e.remove()}))},e}(),h=[],p=function(){function e(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1),this.expression=e,this.immediate=t,this.deep=n,this.dirty=!1,this.paused=!1,this.evaluating=!1,this.links=f.head()}return e.prototype.isWatching=function(){return!this.links.isEmpty()},e.prototype.notify=function(){this.evaluating||(this.dirty=!0,this.immediate&&this.update())},e.prototype.update=function(){this.evaluating=!0,this.off(),h.push(this);try{this.result=this.expression()}finally{if(h.pop(),this.dirty=!1,this.onResult)try{this.onResult()}finally{this.evaluating=!1}this.evaluating=!1}},e.prototype.off=function(){this.links.forEach((function(e){return e.remove()}))},e.prototype.pause=function(){this.paused||(this.off(),this.paused=!0)},e.prototype.resume=function(){this.paused&&(this.update(),this.paused=!1)},e}(),m=function(){function e(e,t){this.watcher=e,this.dependency=t,this.watcherNode=new f(this),this.dependencyNode=new f(this)}return e.prototype.remove=function(){this.watcherNode.remove(),this.dependencyNode.remove()},e.create=function(t,n){var i=null;return n.links.forEach((function(e){return i=e.watcher===t?e:i})),i||(i=new e(t,n),n.links.push(i.dependencyNode),t.links.push(i.watcherNode)),i},e}(),v={get:function(e,t,n){var i=e[t];if("$obs"===t)return i;var r=e.$obs;if("function"==typeof i){if(e instanceof Array){if(t in a)return function(e,t,n){return function(){for(var i=e.slice(),r=t.apply(e,arguments),o=Math.max(i.length,e.length),s=!1,c=0;c<o;c++)i[c]!==e[c]&&(s=s||n.notify(c)),c>=e.length&&n.remove(c);return e.length!==i.length&&(s=s||n.notify("length")),s&&n.parent&&n.parent.notify(!0),r}}(e,i,r);if(t in l)return function(e,t,n){return function(){for(var i=e.length,r=0;r<i;r++)y(e,r,e[r],n);return y(e,"length",e.length,n),t.apply(e,arguments)}}(e,i,r)}return i}return y(e,t,i,r)},set:function(e,t,n,i){n!==e[t]&&(e[t]=n,e.$obs.notify(t,!0));return!0},deleteProperty:function(e,t){return e.$obs.remove(t),!0}};function y(e,t,n,i){var r=i.dep(t);return h.forEach((function(e){return m.create(e,r)})),E(n)&&!g(n)&&(e[t]=n=b(n,{parent:r})),n}function b(e,t){var n=(void 0===t?{}:t).parent,i=void 0===n?null:n;if(E(e)&&!e.$obs){var r=Proxy.revocable(e,v);e=r.proxy,Object.defineProperty(e,"$obs",{value:new x(r.revoke,i),writable:!1,configurable:!0,enumerable:!1})}return e}function E(e){return!("object"!=typeof e||null===e)}function g(e){return!("object"!=typeof e||null===e||!e.$obs)}var x=function(){function e(e,t){void 0===t&&(t=null),this.revoke=e,this.parent=t,this.deps=Object.create(null)}return e.prototype.dep=function(e){var t=this.deps[e];return t||(this.deps[e]=t=new d(this)),t},e.prototype.notify=function(e,t){void 0===t&&(t=!1);var n=this.deps;return e in n?n[e].notify(t):(t&&this.parent&&this.parent.notify(t),!1)},e.prototype.remove=function(e){var t=this.deps;e in t&&(t[e].destroy(),delete t[e])},e.prototype.destroy=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var i=this.deps;for(var r in i)if(i[r].destroy(),delete i[r],t){var o=e[r];if(g(o))o.$obs.destroy(o,t,n)}n&&this.revoke()},e}();function w(e,t){var n=void 0===t?{}:t,i=n.immediate,r=void 0===i||i,o=n.deep,s=new p(e,r,void 0!==o&&o);return s.update(),s}class O{constructor(e=null,t={}){this.parent=e,this.data=e?r(e.data,t):i(t),this.observed=b(this.data),this.disables=0,this.link=new f(this),this.watchers=f.head()}addToParent(){this.parent&&(this.parent.children||(this.parent.children=f.head()),this.link.insertAfter(this.parent.children))}createChild(e={},t=!0){const n=new O(this,e);return t&&n.addToParent(),n}get(e,t){return e in this.observed?this.observed[e]:t}set(e,t){this.observed[e]=t}setMany(e){o(this.observed,e)}watch(e,t){const n=u.LiveRuntime.eval(e),i=w(()=>{t(n(this.observed))}),r=new f(i);return r.insertAfter(this.watchers),()=>{i.off(),r.remove()}}eval(e){const t=u.LiveRuntime.eval(e);return e=>t(e?Object.assign(Object.assign({},this.data),e):this.data)}enable(){this.disables>0&&(this.disables--,0===this.disables&&this.watchers.forEach(e=>e.resume()),this.children&&this.children.forEach(e=>e.enable()))}disable(){0===this.disables&&this.watchers.forEach(e=>e.pause()),this.children&&this.children.forEach(e=>e.disable()),this.disables++}setEnabled(e){e?this.enable():this.disable()}destroy(){this.link.remove(),this.disables=Number.MAX_SAFE_INTEGER,this.watchers.forEach(e=>e.off()),this.children&&this.children.forEach(e=>e.destroy()),function(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n=!0),g(e)){var i=e.$obs;delete e.$obs,i.destroy(e,t,n)}}(this.observed)}static isWatchable(e){return Object(s.isArray)(e)||e instanceof s.Expression}}class j{constructor(e,t,n){this.component=e,this.cache=Object.create(null),this.scope=new O(n?n.scope:null),this.slots=t,this.parent=n,this.listeners=Object.create(null)}trigger(e,t){e in this.listeners&&this.listeners[e].forEach(e=>e(t))}on(e,t){return e in this.listeners||(this.listeners[e]=[]),this.listeners[e].push(t),()=>{const n=this.listeners[e].indexOf(t);-1!==n&&this.listeners[e].splice(n,1)}}update(){this.component.updated&&this.node&&this.component.updated(this,this.node.element)}render(){}destroy(){this.scope.destroy(),this.listeners=Object.create(null)}}const C={collection:"expangine",name:"root",attributes:{},events:{},slots:{},render:()=>[":slot",{},{},[]]};function S(e){const[t]=e,n=Object(s.isString)(t)?t in M?t:t in c?":component":"*":":dynamic";return M[n]}function I(e,t,n,i){return S(e)(e,t,n,i)}function T(e,t,n){const i=new O(null,{page:e,refs:{}}),r=new j(C,{default:t}),o=I(t,r,i);if(n.parentElement){for(const e of o.element)n.parentElement.insertBefore(e,n);n.parentElement.removeChild(n)}return r.node=o,r}function A(e){return!!e&&Object(s.isObject)(e.style)}function R(e,t="default"){return e?Object(s.isArray)(e)?e:Object(s.isObject)(e)&&e[t]?[e[t]]:[]:[]}function _(e){return"object"==typeof e&&!Array.isArray(e)}function k(e,t){for(let n=0;n<t.length;n++){const i=t[n],r=e.element[n];if(r!==i)if(r&&r.parentElement)r.parentElement.replaceChild(i,r),e.element[n]=i;else if(!r&&n>0){const t=e.element[n-1],r=t.nextSibling;r&&r.parentElement?r.parentElement.insertBefore(i,r):!r&&t&&t.parentElement&&t.parentElement.appendChild(i),e.element[n]=i}}for(let n=e.element.length-1;n>=t.length;n--){const t=e.element[n];t.parentElement&&t.parentElement.removeChild(t),e.element.splice(n,1)}}function N(e,t,n,i,r){const o=[],c=[];for(const u of e)if(Object(s.isString)(u))o.push(document.createTextNode(u));else if(u instanceof s.Expression){const e=document.createTextNode("");t.watch(u,t=>{e.textContent=t}),o.push(e)}else{const e=I(u,n,i,r);for(const t of e.element)o.push(t);c.push(e.scope),r.children?r.children.push(e):r.children=[e]}return{element:o,updateScopes(e){for(const t of c)t.setMany(e)},destroyScopes(){for(const e of c)e.destroy()}}}const P=(e,t,n,i)=>{const[r,o,,c]=e,u=":show"===r,a=[document.createComment(r.substring(1))],l={parent:i,component:t,scope:n,element:a.slice()},f=n.createChild(),d=R(c);if(!(o&&o.condition&&d))throw new Error(`The ${r} directive requires a condition attribute and a singule child.`);{const e=N(d,n,t,f,l);let i;n.watch(o.condition,t=>{const n=!!t;if(i!==n){i=n;const t=i===u;if(Object(s.isString)(d)){const n=l.element,i=t?e.element:a;n!==i&&k(l,i)}else A(l.element)&&(l.element.style.display=t?"":"none");f.setEnabled(t)}})}return l},M={"*":(e,t,n,i)=>{const[r,o,c,u]=e,a=document.createElement(r),l={element:[a],component:t,scope:n,parent:i};if(Object(s.isObject)(o))for(const e in o){const n=o[e];O.isWatchable(n)?t.scope.watch(n,t=>{a.setAttribute(e,t)}):a.setAttribute(e,n)}if(Object(s.isObject)(c))for(const e in c){const t=c[e];if(Object(s.isFunction)(t))a.addEventListener(e,t);else{const i=n.eval(t);a.addEventListener(e,e=>{if(!1===i())return!1})}}const f=R(u);if(f.length>0){const e=N(f,n,t,n,l);for(const t of e.element)a.appendChild(t)}return l},":dynamic":(e,t,n,i)=>{const[r]=e,o={parent:i,component:t,scope:n,element:[document.createComment("dynamic")]};let s;return t.scope.watch(r,r=>{e[0]=r,s&&s.scope.destroy();const c=I(e,t,n,i);k(o,c.element),s=c}),o},":component":(e,t,n,i)=>{const[r,o,u,a]=e,l=c[r],f=new j(l,_(a)?a:void 0,t),d=l.render(f),h=n.createChild({this:f,refs:{}}),p=I(d,f,h,i);if(n&&n.data.refs&&l.ref&&(n.data.refs[l.ref]=f),f.node=p,f.scope=h,l.attributes)for(const e in l.attributes){const t=l.attributes[e],i=t instanceof s.Type?{type:t}:t,r=o&&e in o?o[e]:i.default;if(O.isWatchable(r)){let t=!0;n.watch(r,n=>{h.set(e,n),p.element&&(t&&i.initial?i.initial(n,f,p.element):!t&&i.changed&&i.changed(n,f,p.element),i.update&&i.update(n,f,p.element),!t&&l.updated&&l.updated(f,p.element)),t=!1})}else h.set(e,r)}if(l.state){const e=n.eval(l.state)();if(Object(s.isObject)(e))for(const t in e)h.set(t,e[t])}if(Object(s.isObject)(u)&&l.events)for(const e in u){if(!(e in l.events))continue;const t=u[e];if(O.isWatchable(t)){const n=h.eval(t);f.on(e,n)}}return l.created&&p.element&&l.created(f,p.element),p},":if":(e,t,n,i)=>{const[,r,,o]=e,s=[document.createComment("if")],c={parent:i,component:t,scope:n,element:s.slice()},u=n.createChild(),a=R(o);if(!(r&&r.condition&&a))throw new Error("The :if directive requires a condition attribute and a single child.");{const e=N(a,n,t,u,c);let i=!1;n.watch(r.condition,t=>{const n=!!t;if(i!==n){i=n;const t=c.element,r=i?e.element:s;t!==r&&k(c,r),u.setEnabled(i)}})}return c},":show":P,":hide":P,":slot":(e,t,n,i)=>{const[,r,,o]=e,s={parent:i,component:t,scope:n,element:[document.createComment("slot")]};if(r){const e=r.name||"default",i=n.createChild(),c=R(t.slots,e)||R(o,e);if(r.scope)for(const e in i){const t=i[e];O.isWatchable(t)?n.watch(t,n=>{i.set(e,t)}):i.set(e,t)}if(c){const e=N(c,n,t,i,s);s.element=e.element}}return s},":for":(e,t,n,i)=>{const[,r,,o]=e,s=document.createComment("for"),c={parent:i,component:t,scope:n,element:[s]},u=R(o);if(r&&r.items&&i){const e=r.item||"item",i=r.index||"index",o=n.eval(r.key),a=new Map;n.watch(r.items,r=>{const l=[s],f=new Set;for(let s=0;s<r.length;s++){const d=r[s],h={[e]:d,[i]:s},p=o(h);let m=a.get(p);if(m)m.updateScopes(h);else{const e=n.createChild(h);m=N(u,e,t,e,c),a.set(p,m)}f.add(p),l.push(...m.element)}k(c,l),a.forEach((e,t)=>{f.has(t)||(e.destroyScopes(),a.delete(t))})})}return c}};n.d(t,"DEFAULT_SLOT",(function(){return"default"})),n.d(t,"COMPILER_DEFAULT",(function(){return"*"})),n.d(t,"COMPILER_DYNAMIC",(function(){return":dynamic"})),n.d(t,"COMPILER_COMPONENT",(function(){return":component"})),n.d(t,"DIRECTIVE_IF",(function(){return":if"})),n.d(t,"DIRECTIVE_SHOW",(function(){return":show"})),n.d(t,"DIRECTIVE_HIDE",(function(){return":hide"})),n.d(t,"DIRECTIVE_FOR",(function(){return":for"})),n.d(t,"DIRECTIVE_SLOT",(function(){return":slot"})),n.d(t,"createScope",(function(){return i})),n.d(t,"createChildScope",(function(){return r})),n.d(t,"copyProperties",(function(){return o})),n.d(t,"compilers",(function(){return M})),n.d(t,"RootComponent",(function(){return C})),n.d(t,"getCompiler",(function(){return S})),n.d(t,"compile",(function(){return I})),n.d(t,"mount",(function(){return T})),n.d(t,"isStyleElement",(function(){return A})),n.d(t,"getSlots",(function(){return R})),n.d(t,"isNamedSlots",(function(){return _})),n.d(t,"changeElement",(function(){return k})),n.d(t,"createChildNodes",(function(){return N})),n.d(t,"Scope",(function(){return O})),n.d(t,"ComponentInstance",(function(){return j})),n.d(t,"ComponentRegistry",(function(){return c}))}])}));
//# sourceMappingURL=expangine-ui.js.map