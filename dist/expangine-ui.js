!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("expangine-runtime"),require("expangine-runtime-live")):"function"==typeof define&&define.amd?define(["expangine-runtime","expangine-runtime-live"],t):"object"==typeof exports?exports["expangine-ui"]=t(require("expangine-runtime"),require("expangine-runtime-live")):e["expangine-ui"]=t(e["expangine-runtime"],e["expangine-runtime-live"])}(window,(function(e,t){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var s=t[i]={i:i,l:!1,exports:{}};return e[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)n.d(i,s,function(t){return e[t]}.bind(null,s));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(t,n){t.exports=e},function(e,n){e.exports=t},function(e,t,n){"use strict";n.r(t);var i=n(0),s=n(1),r={pop:1,push:1,shift:1,unshift:1,reverse:1,splice:1,sort:1},o={concat:1,every:1,fill:1,filter:1,find:1,findIndex:1,forEach:1,includes:1,indexOf:1,join:1,lastIndexOf:1,map:1,reduce:1,reduceRight:1,slice:1,some:1},c=function(){function e(e){this.value=e,this.next=this.prev=this}return e.prototype.forEach=function(e){for(var t=this.next,n=0;t!==this;){var i=t.next;e(t.value,t,n),t=i,n++}return n},e.prototype.toArray=function(){var e=[];return this.forEach((function(t){return e.push(t)})),e},e.prototype.insertAfter=function(e){this.next=e.next,this.prev=e,this.prev.next=this.next.prev=this},e.prototype.push=function(e){e.insertAfter(this.prev)},e.prototype.remove=function(){this.isEmpty()||(this.next.prev=this.prev,this.prev.next=this.next,this.prev=this.next=this)},e.prototype.isEmpty=function(){return this.next===this},e.head=function(){return new e(null)},e}(),u=function(){function e(e){this.observer=e,this.links=c.head()}return e.prototype.notify=function(e){void 0===e&&(e=!1);var t=!1;return this.links.toArray().forEach((function(e){e.watcher.notify(),t=t||e.watcher.deep})),e&&t&&this.observer.parent&&this.observer.parent.notify(e),t},e.prototype.destroy=function(){this.links.forEach((function(e){return e.remove()}))},e}(),a=[],l=function(){function e(e,t,n){void 0===t&&(t=!0),void 0===n&&(n=!1),this.expression=e,this.immediate=t,this.deep=n,this.dirty=!1,this.paused=!1,this.evaluating=!1,this.links=c.head()}return e.prototype.isWatching=function(){return!this.links.isEmpty()},e.prototype.notify=function(){this.evaluating||(this.dirty=!0,this.immediate&&this.update())},e.prototype.update=function(){this.evaluating=!0,this.off(),a.push(this);try{this.result=this.expression()}finally{if(a.pop(),this.dirty=!1,this.onResult)try{this.onResult()}finally{this.evaluating=!1}this.evaluating=!1}},e.prototype.off=function(){this.links.forEach((function(e){return e.remove()}))},e.prototype.pause=function(){this.paused||(this.off(),this.paused=!0)},e.prototype.resume=function(){this.paused&&(this.update(),this.paused=!1)},e}(),f=function(){function e(e,t){this.watcher=e,this.dependency=t,this.watcherNode=new c(this),this.dependencyNode=new c(this)}return e.prototype.remove=function(){this.watcherNode.remove(),this.dependencyNode.remove()},e.create=function(t,n){var i=null;return n.links.forEach((function(e){return i=e.watcher===t?e:i})),i||(i=new e(t,n),n.links.push(i.dependencyNode),t.links.push(i.watcherNode)),i},e}(),d={get:function(e,t,n){var i=e[t];if("$obs"===t)return i;var s=e.$obs;if("function"==typeof i){if(e instanceof Array){if(t in r)return function(e,t,n){return function(){for(var i=e.slice(),s=t.apply(e,arguments),r=Math.max(i.length,e.length),o=!1,c=0;c<r;c++)i[c]!==e[c]&&(o=o||n.notify(c)),c>=e.length&&n.remove(c);return e.length!==i.length&&(o=o||n.notify("length")),o&&n.parent&&n.parent.notify(!0),s}}(e,i,s);if(t in o)return function(e,t,n){return function(){for(var i=e.length,s=0;s<i;s++)h(e,s,e[s],n);return h(e,"length",e.length,n),t.apply(e,arguments)}}(e,i,s)}return i}return h(e,t,i,s)},set:function(e,t,n,i){n!==e[t]&&(e[t]=n,e.$obs.notify(t,!0));return!0},deleteProperty:function(e,t){return e.$obs.remove(t),!0}};function h(e,t,n,i){var s=i.dep(t);return a.forEach((function(e){return f.create(e,s)})),m(n)&&!v(n)&&(e[t]=n=p(n,{parent:s})),n}function p(e,t){var n=(void 0===t?{}:t).parent,i=void 0===n?null:n;if(m(e)&&!e.$obs){var s=Proxy.revocable(e,d);e=s.proxy,Object.defineProperty(e,"$obs",{value:new b(s.revoke,i),writable:!1,configurable:!0,enumerable:!1})}return e}function m(e){return!("object"!=typeof e||null===e)}function v(e){return!("object"!=typeof e||null===e||!e.$obs)}var b=function(){function e(e,t){void 0===t&&(t=null),this.revoke=e,this.parent=t,this.deps=Object.create(null)}return e.prototype.dep=function(e){var t=this.deps[e];return t||(this.deps[e]=t=new u(this)),t},e.prototype.notify=function(e,t){void 0===t&&(t=!1);var n=this.deps;return e in n?n[e].notify(t):(t&&this.parent&&this.parent.notify(t),!1)},e.prototype.remove=function(e){var t=this.deps;e in t&&(t[e].destroy(),delete t[e])},e.prototype.destroy=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n=!0);var i=this.deps;for(var s in i)if(i[s].destroy(),delete i[s],t){var r=e[s];if(v(r))r.$obs.destroy(r,t,n)}n&&this.revoke()},e}();function y(e,t){var n=void 0===t?{}:t,i=n.immediate,s=void 0===i||i,r=n.deep,o=new l(e,s,void 0!==r&&r);return o.update(),o}class g{constructor(e=null,t=Object.create(null)){this.parent=e,this.observed=p(t),this.disables=0,this.link=new c(this),this.watchers=c.head()}createChild(e={},t=!0){const n=new g(this,e);return t&&(this.children||(this.children=c.head()),this.children.push(n.link)),n}get(e,t,n=!1){return e in this.observed?this.observed[e]:this.parent&&!n?this.parent.get(e,t):t}has(e,t=!1){return e in this.observed||!(!this.parent||t)&&this.parent.has(e)}set(e,t,n=!1){return!(!(e in this.observed)&&!n&&this.parent&&this.parent.set(e,t))&&(this.observed[e]=t,!0)}remove(e){e in this.observed?delete this.observed[e]:this.parent&&this.parent.remove(e)}setMany(e){for(const t in e)this.set(t,e[t])}watch(e,t,n=!0,r=!1){const o=s.LiveRuntime.defs.getExpression(e),u=s.LiveRuntime.getCommand(o);if(!o.isDynamic())return t(u(this)),()=>{};let a,l=!0;const f=y(()=>{const e=u(this);!n&&l||!l&&r&&i.DataTypes.equals(a,e)||t(e),a=r?i.DataTypes.copy(e):e,l=!1}),d=new c(f);return this.watchers.push(d),()=>{f.off(),d.remove()}}eval(e,t=[]){if(t.length>0){const n="__extra__",r=i.Exprs.const({}),o=i.Exprs.define(Object.assign({[n]:r},t.reduce((e,t)=>(e[t]=i.Exprs.get(n,t),e),{})),s.LiveRuntime.defs.getExpression(e)),c=s.LiveRuntime.eval(o);return e=>(r.value=e||{},c(this))}{const t=s.LiveRuntime.eval(e);return()=>t(this)}}evalNow(e){return this.eval(e)()}enable(){this.disables>0&&(this.disables--,0===this.disables&&this.watchers.forEach(e=>e.resume()),this.children&&this.children.forEach(e=>e.enable()))}disable(){0===this.disables&&this.watchers.forEach(e=>e.pause()),this.children&&this.children.forEach(e=>e.disable()),this.disables++}setEnabled(e){e?this.enable():this.disable()}destroy(){this.link.remove(),this.disables=Number.MAX_SAFE_INTEGER,this.watchers.forEach(e=>e.off()),this.children&&this.children.forEach(e=>e.destroy()),function(e,t,n){if(void 0===t&&(t=!1),void 0===n&&(n=!0),v(e)){var i=e.$obs;delete e.$obs,i.destroy(e,t,n)}}(this.observed)}static register(){if(!this.registered){const{dataSet:e,dataGet:t,dataHas:n,dataRemove:r}=s.LiveRuntime;s.LiveRuntime.dataGet=(e,n)=>e instanceof g?e.get(n):t(e,n),s.LiveRuntime.dataSet=(t,n,i)=>t instanceof g?t.set(n,i):e(t,n,i),s.LiveRuntime.dataHas=(e,t)=>e instanceof g?e.has(t):n(e,t),s.LiveRuntime.dataRemove=(e,t)=>e instanceof g?e.remove(t):r(e,t),i.DataTypes.addCopier({priority:12,copy:e=>{if(e instanceof Event)return e}}),this.registered=!0}}static isWatchable(e){return s.LiveRuntime.defs.isExpression(e)}}function O(e,t){return x[t||`${e.collection}/${e.name}`]=e,e}g.registered=!1,g.register();const x=Object.create(null);class E{constructor(e,t,n,i,s,r){this.component=e,this.attrs=t,this.scope=n,this.outerScope=r||n,this.slots=i,this.parent=s,this.cache=Object.create(null)}call(e,t){const n=this.getAttributeExpression(e);if(n){const e=i.Exprs.define();for(const n in t)e.with(n,i.defs.getExpression(t[n]));return e.run(i.defs.getExpression(n)),e}return i.Exprs.noop()}callable(e){const t=this.getAttributeOptions(e),n=this.getAttributeExpression(e);if(!t||!t.callable||!n)throw new Error(`The ${e} is not callable.`);const i=Object.keys(t.callable.options.props);return this.scope.eval(n,i)}trigger(e,t){this.scope.observed.emit[e]=t}on(e,t){return this.scope.watch(i.Exprs.get("emit",e),t,!1)}update(){this.component.updated&&this.node&&this.component.updated(this)}render(){this.cache=Object.create(null);const e=w(this.component.render(this),this,this.scope);R(this.node.elements,e.elements),this.node=e}destroy(){this.scope.destroy()}getAttributeOptions(e){var t;const n=null===(t=this.component.attributes)||void 0===t?void 0:t[e];return!!n&&(n instanceof i.Type?{type:n}:n)}getAttributeExpression(e){const t=this.getAttributeOptions(e);return this.attrs[e]||!!t&&t.default}getSlotArrayLength(e="default"){const t=this.getSlotOptions(e);if(t&&t.arrayLength)return i.defs.getExpression(t.arrayLength);if(this.slots&&this.slots[e]&&Object(i.isObject)(this.slots[e])){const t=this.slots[e];let n;for(const e in t){const t=parseInt(e);Object(i.isNumber)(t)&&(void 0===n||t>n)&&(n=t)}if(void 0!==n)return i.Exprs.const(n+1)}return i.Exprs.const(0)}getSlotOptions(e="default"){if(this.component.slots){const n=this.component.slots[e];return t=n,Object(i.isObject)(t)&&t.scope instanceof i.Type?n:{scope:n}}var t;return!1}getSlotSize(e="default",t=0){return A(this.slots,e,t).length}hasSlot(e,t,n){return e in this.slots?t:n}whenSlot(e,t,n){return e in this.slots?n():t()}}function j(e){const[t]=e,n=Object(i.isString)(t)?t in M?t:t in x?":component":"*":":dynamic";return M[n]}function w(e,t,n,i){return j(e)(e,t,n,i)}function S(e,t,n){const i=new g(null,Object.assign(Object.assign({},e),{refs:{}})),s=new E({collection:"expangine",name:"mounted",attributes:{},events:{},slots:{},state:{},computed:{},render:()=>t},{},i),r=w(t,s,i);return n&&R([n],r.elements),s.node=r,s}function C(e){return!!e&&Object(i.isObject)(e.style)}function A(e,t="default",n=0){return e?Object(i.isArray)(e)?e:Object(i.isObject)(e)&&Object(i.isArray)(e[t])?e[t]:Object(i.isObject)(e)&&Object(i.isObject)(e[t])&&Object(i.isArray)(e[t][n])?e[t][n]:[]:[]}function I(e){return"object"==typeof e&&!Array.isArray(e)}function R(e,t){if(0===e.length)e.push(...t);else{const n=e[0].parentNode;if(n){const i=new Set(e);let s=e[0].previousSibling;for(let r=0;r<t.length;r++){const o=t[r],c=s?s.nextSibling:e[r];i.delete(o),c!==o&&(c?n.insertBefore(o,c):!s&&n.firstChild?n.insertBefore(o,n.firstChild):n.appendChild(o)),s=o}for(const e of i)n.removeChild(e)}e.splice(0,e.length,...t)}}function L(e,t,n,s,r=!1){const o=[],c=[];for(const r of e)if(Object(i.isString)(r))o.push(document.createTextNode(r));else if(g.isWatchable(r)){const e=document.createTextNode("");t.watch(r,t=>{e.textContent=t}),o.push(e)}else{const e=w(r,n,t,s);for(const t of e.elements)o.push(t);e.scope!==t&&c.push(e.scope),s.children?s.children.push(e):s.children=[e]}return{elements:o,updateScopes(e){t.setMany(e);for(const t of c)t.setMany(e)},destroy(){r||t.destroy();for(const e of c)e.destroy()}}}const T={prevent:(e,t)=>(t.preventDefault&&t.preventDefault(),!0),stop:(e,t)=>(t.stopPropagation&&t.stopPropagation(),!0),self:(e,t)=>t.target===e};function N(e,t){const n=e.indexOf(t),i=n>=0;return i&&e.splice(n,1),i}function k(e,t,n){const s=function e(t,n=!1){if(Object(i.isArray)(t))return t.map(t=>e(t)).filter(e=>Boolean(e)).join(n?"; ":" ");if(Object(i.isObject)(t)){const i=[];for(const s in t)(t[s]||n&&0===t[s])&&i.push(n?s+": "+e(t[s]):s);return i.join(n?"; ":" ")}return null==t||!1===t?"":String(t)}(n,"style"===t.toLowerCase());""===s?e.hasAttribute(t)&&e.removeAttribute(t):e.setAttribute(t,s)}const _=(e,t,n,s)=>{const[r,o,,c]=e,u=r.substring(1),a=[document.createComment(u)],l=a.slice(),f={parent:s,component:t,scope:n,elements:l},d=n.createChild();if(!(o&&o.cases&&o.value))throw new Error(`The ${r} directive requires a cases and value attribute.`);{const e=o.mode||"detach",s=i.defs.getExpression(o.value),r=i.Exprs.switch(s,o.isEqual||i.AnyOps.isEqual);for(const e in o.cases)r.case(o.cases[e]).than(e);let u,l;r.default("default"),n.watch(r,n=>{const i=A(c,n);if(0===i.length)switch(d.setEnabled(!1),e){case"detach":R(f.elements,a);break;case"destroy":l&&(l.destroy(),l=void 0),R(f.elements,a);break;case"hide":if(l){const e=f.elements.slice();for(let t=0;t<e.length;t++){const n=e[t];C(n)?n.style.display="none":e[t]=document.createComment("")}R(f.elements,e)}}else{if(n!==u||"destroy"===e){l&&(l.destroy(),l=void 0);const e=L(i,d,t,f,!0);R(f.elements,e.elements),l=e,u=n}else if("detach"===e)R(f.elements,l.elements);else{const e=f.elements.slice();for(let t=0;t<e.length;t++){const n=e[t];C(n)?n.style.display="":e[t]=l.elements[t]}R(f.elements,e)}d.setEnabled(!0)}},!0,!0)}return f};const M={"*":(e,t,n,s)=>{const[r,o,c,u]=e,a=document.createElement(r),l={elements:[a],component:t,scope:n,parent:s};if(Object(i.isObject)(o))for(const e in o){const t=o[e];g.isWatchable(t)?n.watch(t,t=>{k(a,e,t)}):k(a,e,t)}if(Object(i.isObject)(c))for(const e in c){const t=e.split("."),s=t.shift(),r=c[s],o={once:N(t,"once"),passive:N(t,"passive"),capture:N(t,"capture")},u=Object(i.isFunction)(r)?r:n.eval(r,["nativeEvent","stop","prevent"]);a.addEventListener(s,e=>{for(const n of t)if(n in T&&!T[n](a,e))return;const n={nativeEvent:e,stop:!1,prevent:!1};if(!1===u(n))return!1;for(const t in n)if(n[t]&&t in T&&!T[t](a,e))return},o)}const f=A(u);if(f.length>0){const e=L(f,n,t,l);for(const t of e.elements)a.appendChild(t)}return l},":dynamic":(e,t,n,i)=>{const[s]=e,r={parent:i,component:t,scope:n,elements:[document.createComment("dynamic")]};let o;return n.watch(s,s=>{e[0]=s,o&&o.destroy(),o=n.createChild();const c=w(e,t,o,i);R(r.elements,c.elements)},!0,!0),r},":component":(e,t,n,s)=>{const[r,o,c,u]=e,a=x[r],l=new g(null,{emit:{},refs:{}}),f=new E(a,o,l,I(u)?u:void 0,t,n),d=null==o?void 0:o.ref;if(d&&delete o.ref,a.attributes)for(const e in a.attributes){const t=f.getAttributeOptions(e);if(!t||t.callable)continue;const i=o&&e in o?o[e]:t.default;if(g.isWatchable(i)){let s=!0;n.watch(i,n=>{l.set(e,n,!0),s&&t.initial?t.initial(n,f):!s&&t.changed&&t.changed(n,f),t.update&&t.update(n,f),!s&&a.updated&&a.updated(f),s=!1})}else l.set(e,i,!0)}if(a.state)for(const e in a.state){const t=a.state[e];l.set(e,l.evalNow(t),!0)}if(a.computed)for(const e in a.computed){const t=a.computed[e];l.watch(t,t=>{l.set(e,t,!0)})}if(Object(i.isObject)(c)&&a.events)for(const e in c){if(!(e in a.events))continue;const t=c[e];if(g.isWatchable(t)){const i=Object.keys(a.events[e].options.props),s=n.eval(t,i);f.on(e,s)}}const h=w(a.render(f),f,l,s);return f.node=h,a.created&&a.created(f),d&&t&&(t.scope.observed.refs[d]=l.observed),h},":if":([e,t,n,i],s,r,o)=>_([e,Object.assign({value:!0},t),n,i],s,r,o),":slot":(e,t,n,i)=>{const[,s,,r]=e,o={parent:i,component:t,scope:n,elements:[document.createComment("slot")]};if(s){const e=s.name||"default",i=s.slotIndex&&n.evalNow(s.slotIndex)||0,c=A(t.slots,e,i),u=c.length>0,a=u?c:A(r,e,i),l=u?t.outerScope.createChild():n.createChild();if(s.slotIndex){const n=t.getSlotOptions(e),s=n&&n.arrayIndexAlias||"slotIndex";l.set(s,i)}if(s.scope)for(const e in s.scope){const t=s.scope[e];g.isWatchable(t)?n.watch(t,t=>{l.set(e,t,!0)}):l.set(e,t,!0)}if(a){const e=L(a,l,t,o);o.elements=e.elements}}return o},":for":(e,t,n,s)=>{const[,r,,o]=e,c=document.createComment("for"),u={parent:s,component:t,scope:n,elements:[c]},a=A(o);if(r&&r.items){const e=r.item||"item",s=r.index||"index",o=r.key||i.Exprs.get(s),l=n.eval(o,[e,s]),f=new Map;n.watch(r.items,r=>{const o=[c],d=new Set;!function(e,t){if(Object(i.isArray)(e))for(let n=0;n<e.length;n++)t(e[n],n);else if(Object(i.isSet)(e)){let n=0;for(const i of e)t(i,n++)}else if(Object(i.isMap)(e))for(const[n,i]of e.entries())t(i,n);else if(Object(i.isObject)(e))for(const n in e)t(e[n],e);else if(Object(i.isNumber)(e))for(let n=0;n<e;n++)t(n,n)}(r,(i,r)=>{const c={[e]:i,[s]:r},h=l(c);let p=f.get(h);if(p)p.updateScopes(c);else{const e=n.createChild(c);p=L(a,e,t,u),f.set(h,p)}d.add(h),o.push(...p.elements)}),R(u.elements,o),f.forEach((e,t)=>{d.has(t)||(e.destroy(),f.delete(t))})})}return u},":switch":_};function $(e,t,n="detach"){return D([[e,t]],void 0,n)}function P(e,t,n,i="detach"){return D([[e,t]],n,i)}function D(e,t,n="detach"){return[":if",{mode:n,cases:e.reduce((e,[t],n)=>(e[n]=t,e),{})},{},Object.assign(Object.assign({},e.reduce((e,[,t],n)=>(e[n]=t,e),{})),{default:t})]}function q(e,t){return D([[e,t]],void 0,"hide")}function W(e,t){return D([[i.Exprs.not(e),t]],void 0,"hide")}function F(e,t,n,i){return[":switch",{value:e,cases:t.reduce((e,[t],n)=>(e[n]=t,e),{}),isEqual:i},{},Object.assign(Object.assign({},t.reduce((e,[,t],n)=>(e[n]=t,e),{})),{default:n})]}function H(e,t={},n={},i={}){return[`${e.collection}/${e.name}`,t,n,i]}function V(e,t,n={}){return[":for",Object.assign({items:e},n),{},t]}function B(e={},t=[]){return[":slot",e,{},t]}n.d(t,"DEFAULT_SLOT",(function(){return"default"})),n.d(t,"COMPILER_DEFAULT",(function(){return"*"})),n.d(t,"COMPILER_DYNAMIC",(function(){return":dynamic"})),n.d(t,"COMPILER_COMPONENT",(function(){return":component"})),n.d(t,"DIRECTIVE_IF",(function(){return":if"})),n.d(t,"DIRECTIVE_SWITCH",(function(){return":switch"})),n.d(t,"DIRECTIVE_FOR",(function(){return":for"})),n.d(t,"DIRECTIVE_SLOT",(function(){return":slot"})),n.d(t,"compilers",(function(){return M})),n.d(t,"getCompiler",(function(){return j})),n.d(t,"compile",(function(){return w})),n.d(t,"mount",(function(){return S})),n.d(t,"createIf",(function(){return $})),n.d(t,"createIfElse",(function(){return P})),n.d(t,"createIfs",(function(){return D})),n.d(t,"createShow",(function(){return q})),n.d(t,"createHide",(function(){return W})),n.d(t,"createSwitch",(function(){return F})),n.d(t,"createComponent",(function(){return H})),n.d(t,"createFor",(function(){return V})),n.d(t,"createSlot",(function(){return B})),n.d(t,"isStyleElement",(function(){return C})),n.d(t,"getSlots",(function(){return A})),n.d(t,"isNamedSlots",(function(){return I})),n.d(t,"changeElements",(function(){return R})),n.d(t,"createChildNodes",(function(){return L})),n.d(t,"Scope",(function(){return g})),n.d(t,"ComponentInstance",(function(){return E})),n.d(t,"addComponent",(function(){return O})),n.d(t,"ComponentRegistry",(function(){return x}))}])}));
//# sourceMappingURL=expangine-ui.js.map